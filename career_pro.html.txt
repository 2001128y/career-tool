<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¬è¡Œæƒ…æŠ¥åˆ†æå¸ˆ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* ä¼˜åŒ– Markdown æ¸²æŸ“åçš„æ’ç‰ˆ */
        .prose h1, .prose h2, .prose h3 { color: #1e40af; margin-top: 1.5em; margin-bottom: 0.5em; font-weight: bold; }
        .prose h1 { font-size: 1.5rem; border-bottom: 2px solid #bfdbfe; padding-bottom: 0.3em; }
        .prose h2 { font-size: 1.25rem; }
        .prose p { margin-bottom: 1em; line-height: 1.7; color: #374151; }
        .prose ul, .prose ol { margin-left: 1.5em; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.5em; list-style-type: disc; }
        .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1.5em; }
        .prose th, .prose td { border: 1px solid #e5e7eb; padding: 0.75em; text-align: left; }
        .prose th { background-color: #f3f4f6; font-weight: bold; }
        .prose strong { color: #111827; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 mb-2">ğŸ§­ è½¬è¡Œæƒ…æŠ¥åˆ†æç³»ç»Ÿ Pro</h1>
            <p class="text-slate-500">Describe ç°çŠ¶å®šé”š â†’ Predict åˆ†çº§é¢„æµ‹ â†’ Execute åˆ†è½¨æ‰§è¡Œ</p>
        </header>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">ğŸ”‘ AI API Key (ç”¨äºè°ƒç”¨æ¨¡å‹)</label>
                    <input type="password" id="apiKey" placeholder="è¾“å…¥ä½ çš„ Gemini API Key" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <p class="text-xs text-slate-400 mt-1">ä»…åœ¨æœ¬åœ°è¿è¡Œï¼Œä¸ä¼šä¸Šä¼ æœåŠ¡å™¨</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">ğŸ“ ç›®æ ‡åŸå¸‚/å¸‚åœº</label>
                    <input type="text" id="city" value="æ·±åœ³" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold text-slate-700 mb-2">ğŸ‘¤ å½“å‰èµ„äº§ä¸èƒŒæ™¯ (è¶Šè¯¦ç»†è¶Šå¥½)</label>
                <textarea id="background" rows="3" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">è‹±è¯­ä¸“å…«ï¼Œè‹±ç¡•å­¦å†ï¼Œ1å¹´2ä¸ªæœˆä½“åˆ¶å†…å¤§å‹é‡ç‚¹é¡¹ç›®ç»Ÿç­¹ä¸åˆè§„ç®¡ç†ç»éªŒï¼Œæ‰§è¡ŒåŠ›å¼ºï¼Œæƒ³è¦è„±ç¦»ä½“åˆ¶å†…å¯»æ‰¾æ›´é«˜è–ªèµ„ä¸Šé™ã€‚</textarea>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold text-slate-700 mb-2">ğŸ¯ ç›®æ ‡è¡Œä¸šä¸å²—ä½</label>
                <input type="text" id="target" value="ç¡¬ç§‘æŠ€ä¼ä¸šï¼ˆå¦‚å‚¨èƒ½/å•†ç”¨æœºå™¨äººï¼‰æµ·å¤–å¤§å®¢æˆ·BD" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
            </div>

            <button onclick="generateReport()" id="genBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 shadow-md">
                ğŸš€ ä¸€é”®ç”Ÿæˆæˆ˜ç•¥æ²™ç›˜æŠ¥å‘Š
            </button>
            <p id="loadingText" class="text-center text-blue-600 font-medium mt-4 hidden animate-pulse">
                ç³»ç»Ÿæ­£åœ¨è¿›è¡Œæ·±åº¦æ£€ç´¢ä¸æˆ˜ç•¥æ¼”ç®—ï¼Œè¿™å¯èƒ½éœ€è¦ 15-30 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…...
            </p>
        </div>

        <div id="resultContainer" class="hidden">
            <div class="flex justify-end mb-4">
                <button onclick="downloadPDF()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200 shadow-md flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    å¯¼å‡ºä¸º PDF æŠ¥å‘Š
                </button>
            </div>
            
            <div id="reportContent" class="bg-white rounded-xl shadow-sm border border-slate-200 p-8 md:p-12 prose max-w-none">
                </div>
        </div>
    </div>

    <script>
        // ä½ ä¹‹å‰è®¾å®šå¥½çš„é‚£ä¸ªå·¨å¤§ä¸”ä¸“ä¸šçš„ Prompt æ ¸å¿ƒæŒ‡ä»¤
        const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªé¡¶çº§çš„"è½¬è¡Œæƒ…æŠ¥åˆ†æå¸ˆ"ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„èƒŒæ™¯ã€ç›®æ ‡å’ŒåŸå¸‚ï¼Œç”Ÿæˆä¸€ä»½ä¸“ä¸šçš„ã€èŒä¸šæˆ˜ç•¥æ²™ç›˜ä¸è½¬è¡Œæƒ…æŠ¥æŠ¥å‘Šã€‘ã€‚
        å¿…é¡»ä¸¥æ ¼åŒ…å«ä¸‰å¤§æ¿å—ï¼š
        ã€PART 1: Describe | ç°çŠ¶å®šé”šã€‘åˆ†æå…¶æ ¸å¿ƒèµ„äº§ã€è½¬è¡Œä¼˜åŠ£åŠ¿ï¼Œå¹¶æä¾›ç›®æ ‡å²—ä½çš„çœŸå®å¸‚åœºæƒ…æŠ¥ä¸æŠ€èƒ½Gapåˆ†æï¼ˆç”¨è¡¨æ ¼ï¼‰ã€‚
        ã€PART 2: Predict | ä¸‰ç»´ç›®æ ‡åˆ†çº§ã€‘ç”¨è¡¨æ ¼è¾“å‡ºâ€œä¿å®ˆå‹ã€åŠªåŠ›å‹ã€å†²åˆºå‹â€ä¸‰ä¸ªçº§åˆ«å¯¹åº”çš„ä¼ä¸šç”»åƒã€è–ªèµ„é¢„æµ‹åŠè¾¾æˆæ¦‚ç‡ã€‚
        ã€PART 3: Execute | åˆ†è½¨æ‰§è¡Œã€‘æä¾›HRè§†è§’å¯ä¿¡åº¦è¯„åˆ†ã€é¢è¯•é«˜é¢‘è¯æœ¯é‡æ„å»ºè®®ï¼Œä»¥åŠé’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªçº§åˆ«çš„å…·ä½“è½åœ°è¡ŒåŠ¨è·¯çº¿å›¾ã€‚
        è¯­æ°”ä¸“ä¸šã€å†·è¡€å®¢è§‚ã€ä¸åºŸè¯ï¼Œç›´æ¥è¾“å‡ºæŠ¥å‘Šæ­£æ–‡ã€‚`;

        async function generateReport() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const bg = document.getElementById('background').value.trim();
            const target = document.getElementById('target').value.trim();
            const city = document.getElementById('city').value.trim();
            const btn = document.getElementById('genBtn');
            const loading = document.getElementById('loadingText');
            const resultContainer = document.getElementById('resultContainer');
            const reportContent = document.getElementById('reportContent');

            if(!apiKey) { alert("è¯·å…ˆè¾“å…¥ API Keyï¼"); return; }
            if(!bg || !target) { alert("è¯·å®Œå–„èƒŒæ™¯å’Œç›®æ ‡ä¿¡æ¯ï¼"); return; }

            // UI çŠ¶æ€åˆ‡æ¢
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            loading.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            const userPrompt = `ç”¨æˆ·å½“å‰èƒŒæ™¯ï¼š${bg}\nç›®æ ‡åŸå¸‚ï¼š${city}\nç›®æ ‡å²—ä½ï¼š${target}`;

            try {
                // è°ƒç”¨ Gemini API (è¿™é‡Œä½¿ç”¨ Gemini 1.5 Flash ä½œä¸ºç¤ºä¾‹ï¼Œé€Ÿåº¦å¿«)
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [
                            { role: "user", parts: [{ text: systemPrompt + "\n\n" + userPrompt }] }
                        ],
                        generationConfig: { temperature: 0.2 }
                    })
                });

                const data = await response.json();
                
                if(data.error) {
                    throw new Error(data.error.message);
                }

                const markdownText = data.candidates[0].content.parts[0].text;
                
                // å°† Markdown è½¬æ¢ä¸º HTML
                reportContent.innerHTML = marked.parse(markdownText);
                resultContainer.classList.remove('hidden');

            } catch (error) {
                alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API Key æ˜¯å¦æ­£ç¡®ã€‚\né”™è¯¯ä¿¡æ¯ï¼š" + error.message);
            } finally {
                // æ¢å¤ UI çŠ¶æ€
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                loading.classList.add('hidden');
            }
        }

        function downloadPDF() {
            const element = document.getElementById('reportContent');
            const opt = {
                margin:       10,
                filename:     'èŒä¸šæˆ˜ç•¥æ²™ç›˜æŠ¥å‘Š.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>